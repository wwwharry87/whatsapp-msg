<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envio de Mensagens WhatsApp</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px; background-color: #25D366; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Envio de Mensagens para Coordenadores</h1>

    <button id="checkWhatsApp">Verificar WhatsApp</button>
    <button id="enviarMensagens" disabled>Enviar Mensagens</button>

    <div id="qrCodeDiv" style="display:none;">
        <h2>QR Code:</h2>
        <img id="qrCode" />
    </div>

    <script>
        const checkWhatsAppButton = document.getElementById('checkWhatsApp');
        const enviarMensagensButton = document.getElementById('enviarMensagens');
        const qrCodeDiv = document.getElementById('qrCodeDiv');
        const qrCodeImg = document.getElementById('qrCode');

        checkWhatsAppButton.addEventListener('click', async () => {
            const response = await fetch('/api/check-whatsapp');
            const result = await response.json();

            if (result.authenticated) {
                alert('WhatsApp conectado!');
                enviarMensagensButton.disabled = false;
            } else if (result.qrCode) {
                qrCodeDiv.style.display = 'block';
                qrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${result.qrCode}`;
            } else {
                alert('Erro ao conectar ao WhatsApp. Tente novamente.');
            }
        });

        enviarMensagensButton.addEventListener('click', async () => {
            const response = await fetch('/api/enviar', {
                method: 'POST'
            });
            const result = await response.json();

            if (result.success) {
                alert(result.message);
            } else {
                alert('Erro ao enviar mensagens.');
            }
        });
    </script>
</body>
</html>
